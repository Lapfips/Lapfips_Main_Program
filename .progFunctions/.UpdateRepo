#!/bin/bash

cd GitRepositories/

repo_path=$1
repo_url=$2
repo_name=$(basename "$repo_path")

# Cloner le dépôt si le dossier n'existe pas
if [[ ! -d $repo_name ]]; then
    git clone "$repo_url/$repo_path.git"
fi

cd "$repo_name" || exit

# S'assurer d'être sur la bonne branche (ici, on reste sur la branche actuelle)
branch=$(git branch --show-current)

# Récupérer les dernières modifications de la branche actuelle
git fetch origin

# Comparer les commits locaux et distants
local_commit=$(git rev-parse "$branch")
remote_commit=$(git rev-parse "origin/$branch")

# Vérifier s'il y a des modifications distantes à récupérer
if [[ "$local_commit" != "$remote_commit" ]]; then
    echo "Pulling the latest changes from the remote branch..."
    git pull --rebase origin "$branch"
else
    echo "Your local branch is up to date with the remote branch."
fi

# Vérifier les changements locaux non commis
changes=$(git status --porcelain)

if [[ -n $changes ]]; then
    echo "Pushing local changes..."
    git add .
    git commit -m "Auto-update"
    git push origin "$branch"
else
    echo "No local changes to push."
fi

cd
